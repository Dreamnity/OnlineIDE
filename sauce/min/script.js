function main(){var e=1,n="",t="js";const o={js:"javascript",py:"python","g++":"c_cpp",c:"c_cpp",cpp:"c_cpp",gcc:"c_cpp",bash:"sh",shell:"sh"},i=ace.edit("editor");ace.require("ace/ext/language_tools"),i.setOptions({mode:"ace/mode/javascript",theme:"ace/theme/vibrant_ink",autoScrollEditorIntoView:1,enableBasicAutocompletion:1,enableSnippets:1,enableLiveAutocompletion:1});const a=new Terminal({convertEol:1}),s=new FitAddon.FitAddon;function c(){const a=i.getValue();fetch("/api/classify",{method:"POST",body:a}).then((async a=>{const s=await a.text();"null"!==s&&404!==a.status&&(n=s,document.getElementById("lang-auto").innerText="Auto ("+s+")",e&&(document.getElementById("lang").innerText="Auto ("+s+")",i.session.setMode("ace/mode/"+(o[name]||name)),t=s))})),localStorage.setItem("code",a)}function l(a){e=0,"auto"==a&&(e=1,a=n||t),i.session.setMode("ace/mode/"+(o[a]||a)),t=a,document.getElementById("lang").innerHTML=this?.innerHTML||a}var r;a.loadAddon(s),a.open(document.getElementById("terminal")),s.fit(),a.write("[1;3;34mOnlineIDE[0m\n\nUniversal online code editor & compiler\nMade for Canandaigua Academy\n\nMore to come:\n- Multi file support\n- More languages support\n- Dependencies/Libraries manager\n\nOnlineIDE@0.1.2-BETA\n 2024 @ Dreamnity inc."),i.session.on("change",(()=>{clearTimeout(window?.saveInterval),window.saveInterval=setTimeout(c,e?2e3:1e4)})),window.set=l,fetch("/api/list").then((e=>e.json())).then((e=>{const n=document.querySelector("ul.dropdown-menu"),t=/[^a-zA-Z0-9\-_]/g;for(const{language:o,aliases:i,version:a}of e){const e=(t.test(o)&&i.find((e=>!t.test(o)))||o).replace(/\+/g,"c"),s=document.createElement("li"),c=document.createElement("a");c.className="dropdown-item",c.id="lang-"+e,c.innerHTML=`${o} <sup>${a}</sup>`,c.onclick=()=>l(e),s.appendChild(c),n.appendChild(s)}})).finally((()=>document.getElementById("splash").hidden=1)),a.onKey((({key:e})=>{r&&1===r?.readyState&&r.send(e)}));const d=document.getElementById("stop");d.onclick=()=>{r&&r.close(),d.disabled=1};const m=document.getElementById("run");m.onclick=()=>{r&&r?.readyState<=1||(r=new WebSocket("/api/execute?lang="+t),m.innerText="...",r.onopen=()=>{m.classList.add("btn-warning"),m.innerText="30%",a.write("c"),r.send(i.getValue()),d.disabled=0},r.onmessage=e=>{const n=e.data.toString();if("!!ready"!==n)if("!!starting"!==n){if("!!running"==n)return m.innerText="Running",m.classList.remove("btn-warning"),void m.classList.add("btn-success");if(n.startsWith("!!exit ")){if(n.endsWith(" 0"))return;console.error("Code failed with exit code "+n.substring(7))}else a.write(n)}else m.innerText="80%";else m.innerText="50%"},r.onerror=()=>a.write("[31m[client websocket error][0m"),r.onclose=()=>{m.innerText="Run",m.classList.remove("btn-success","btn-warning","btn-info"),d.disabled=1,r=null})},localStorage.getItem("code")&&i.setValue(localStorage.getItem("code"))}main();