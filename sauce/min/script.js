function main(){var e=1,n="",t="js";const o={js:"javascript",py:"python","g++":"c_cpp",c:"c_cpp",cpp:"c_cpp",gcc:"c_cpp",bash:"sh",shell:"sh"},a=ace.edit("editor");ace.require("ace/ext/language_tools"),a.setOptions({mode:"ace/mode/javascript",theme:"ace/theme/vibrant_ink",autoScrollEditorIntoView:1,enableBasicAutocompletion:1,enableSnippets:1,enableLiveAutocompletion:1});const i=new Terminal({convertEol:1}),s=new FitAddon.FitAddon;function c(){const i=a.getValue();fetch("/api/classify",{method:"POST",body:i}).then((async i=>{const s=await i.text();"null"!==s&&404!==i.status&&(n=s,document.getElementById("lang-auto").innerText="Auto ("+s+")",e&&(document.getElementById("lang").innerText="Auto ("+s+")",a.session.setMode("ace/mode/"+(o[s]||s)),t=s))})),localStorage.setItem("code",i)}function r(i){e=0,"auto"==i&&(e=1,i=n||t),a.session.setMode("ace/mode/"+(o[i]||i)),t=i,document.getElementById("lang").innerHTML=this?.innerHTML||i}var l;i.loadAddon(s),i.open(document.getElementById("terminal")),s.fit(),i.write("[1;3;34mOnlineIDE[0m\n\nUniversal online code editor & compiler\nMade for Canandaigua Academy\n\nMore to come:\n- Multi file support\n- More languages support\n- Dependencies/Libraries manager\n\nOnlineIDE v0.2.0\n 2024 @ Dreamnity inc."),fetch("/api/changelog").then((async e=>{200!==e.status?i.write("\n\n[31mCannot request to OnlineIDE server(Are you offline?)"):i.write("\n\n  Live changelog\n[34m"+await e.text()+"[0m")})).catch((()=>{i.write("\n\n[31mCannot request to OnlineIDE server(Are you offline?)")})),a.session.on("change",(()=>{clearTimeout(window?.saveInterval),window.saveInterval=setTimeout(c,e?500:5e3)})),window.set=r,i.onKey((({key:e})=>{l&&1===l?.readyState&&l.send(e)}));const d=document.getElementById("stop");d.onclick=()=>{l&&l.close(),d.disabled=1};const u=document.getElementById("run");u.onclick=()=>{l&&l?.readyState<=1||(l=new WebSocket("/api/execute?lang="+t),u.innerText="...",l.onopen=()=>{u.classList.add("btn-warning"),u.innerText="30%",i.write("c"),l.send(a.getValue()),d.disabled=0},l.onmessage=e=>{const n=e.data.toString();if("!!ready"!==n)if("!!starting"!==n){if("!!running"==n)return u.innerText="Running",u.classList.remove("btn-warning"),void u.classList.add("btn-success");if(n.startsWith("!!exit ")){if(n.endsWith(" 0"))return;console.error("Code failed with exit code "+n.substring(7))}else i.write(n)}else u.innerText="80%";else u.innerText="50%"},l.onerror=()=>i.write("\n[31m[client websocket error][0m"),l.onclose=()=>{u.innerText="Run",u.classList.remove("btn-success","btn-warning","btn-info"),d.disabled=1,l=null})},fetch("/api/list").then((async e=>{if(200!==e.status)return u.classList.add("btn-danger"),u.disabled=1,void(u.innerText="OFFLINE");const n=await e.json(),t=document.querySelector("ul.dropdown-menu"),o=/[^a-zA-Z0-9\-_]/g;for(const{language:e,aliases:a,version:i}of n){const n=(o.test(e)&&a.find((n=>!o.test(e)))||e).replace(/\+/g,"c"),s=document.createElement("li"),c=document.createElement("a");c.className="dropdown-item",c.id="lang-"+n,c.innerHTML=`${e} <sup>${i}</sup>`,c.onclick=()=>r(n),s.appendChild(c),t.appendChild(s)}})).finally((()=>document.getElementById("splash").hidden=1));const m=new URLSearchParams(location.search);if(m.has("code")){const e=atob(m.get("code"));for(a.setValue(e);a.getValue()!==e;)a.setValue(e)}else if(localStorage.getItem("code")){const e=localStorage.getItem("code");for(a.setValue(e);a.getValue()!==e;)a.setValue(e)}}main();