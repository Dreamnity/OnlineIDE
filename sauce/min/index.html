<!doctype html>
<html lang=en data-bs-theme=dark>
<head>
<meta charset=utf-8>
<meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=0">
<title>OnlineIDE</title>
<link href=/bootstrap.min.css rel=stylesheet>
<link href=/styles.css rel=stylesheet>
<link rel=stylesheet href=/module/@xterm/xterm/css/xterm.css>
<script src=/module/@xterm/xterm/lib/xterm.js></script>
<script src=/module/@xterm/addon-fit/lib/addon-fit.js></script>
</head>
<body>
<div class=layout>
<div class=sidebar></div>
<div id=editor-wrapper>
<pre id=editor></pre>
</div>
<div class=overlay-panel>
<div class="btn-group btn-group-sm float-end" role=group aria-label=Actions style=z-index:1>
<button type=button class="btn btn-primary" id=run>Run</button>
<button type=button class="btn btn-warning" disabled id=stop>Stop</button>
<button type=button class="btn btn-secondary" disabled id=lang>Auto Detect</button>
<button type=button class="btn btn-secondary dropdown-toggle dropdown-toggle-split" data-bs-toggle=dropdown aria-expanded=false>
<span class=visually-hidden>Select Language</span>
</button>
<ul class=dropdown-menu>
<li><a class=dropdown-item id=lang-auto onclick='set("auto")'>Automatic detect</a></li>
<li>
<hr class=dropdown-divider>
</li>
</ul>
</div>
<div id=terminal></div>
</div>
</div>
<script src=/ace/ace.js></script>
<script src=/ace/ext-language_tools.js></script>
<script>"serviceWorker"in navigator&&window.addEventListener("load",(()=>navigator.serviceWorker.register("sw.js")))</script>
<script>function main(){var e=!0,n="",t="js";const o=ace.edit("editor");ace.require("ace/ext/language_tools"),o.setOptions({mode:"ace/mode/javascript",theme:"ace/theme/vibrant_ink",autoScrollEditorIntoView:!0,enableBasicAutocompletion:!0,enableSnippets:!0,enableLiveAutocompletion:!0});const i=new Terminal({convertEol:!0}),a=new FitAddon.FitAddon;function s(){const i=o.getValue();fetch("/api/classify",{method:"POST",body:i}).then((async i=>{const a=await i.text();"null"!==a&&404!==i.status&&(n=a,document.getElementById("lang-auto").innerText="Auto ("+a+")",e&&(document.getElementById("lang").innerText="Auto ("+a+")",o.session.setMode("ace/mode/"+name),t=a))})),localStorage.setItem("code",i)}function c(i){e=!1,"auto"==i&&(e=!0,i=n),o.session.setMode("ace/mode/"+i),t=i,document.getElementById("lang").innerHTML=this?.innerHTML||i}var d;i.loadAddon(a),i.open(document.getElementById("terminal")),a.fit(),i.write("[1;3;34mOnlineIDE[0m\n\nUniversal online code editor & compiler\nMade for Canandaigua Academy\n\nMore to come:\n- Multi file support\n- Language selection\n- More languages\n\nOnlineIDE@0.0.0-ALPHA\n 2024 @ Dreamnity inc."),o.session.on("change",(()=>{clearTimeout(window?.saveInterval),window.saveInterval=setTimeout(s,e?2e3:1e4)})),window.set=c,fetch("/api/list").then((e=>e.json())).then((e=>{const n=document.querySelector("ul.dropdown-menu"),t=/[^a-zA-Z0-9\-_]/g;for(const{language:o,aliases:i,version:a}of e){const e=t.test(o)&&i.find((e=>!t.test(o)))||o,s=document.createElement("li"),d=document.createElement("a");d.className="dropdown-item",d.id="lang-"+e,d.innerHTML=`${o} <sup>${a}</sup>`,d.onclick=()=>c(e),s.appendChild(d),n.appendChild(s)}})),i.onKey((({key:e})=>{d&&1===d?.readyState&&d.send(e)}));const l=document.getElementById("stop");l.onclick=()=>{d&&d.close(),l.disabled=!0};const r=document.getElementById("run");r.onclick=()=>{d&&d?.readyState<=1||((d=new WebSocket("/api/execute?lang="+t)).onopen=()=>{r.classList.add("btn-warning"),i.write("c"),d.send(o.getValue()),l.disabled=!1},d.onmessage=e=>{const n=e.data.toString();if("!!ready"!==n){if("!!starting"===n)return r.innerText="80%",r.classList.remove("btn-warning"),void r.classList.add("btn-info");if("!!running"==n)return r.innerText="Running",r.classList.remove("btn-info"),void r.classList.add("btn-success");if(n.startsWith("!!exit ")){if(n.endsWith(" 0"))return;console.error("Code failed with exit code "+n.substring(7))}else i.write(n)}else r.innerText="30%"},d.onerror=()=>i.write("[31m[client websocket error][0m"),d.onclose=()=>{r.innerText="Run",r.classList.remove("btn-success","btn-warning","btn-info"),l.disabled=!0})},localStorage.getItem("code")&&o.setValue(localStorage.getItem("code"))}main()</script>
<script src=/module/bootstrap/dist/js/bootstrap.bundle.min.js></script>
</body>
</html>